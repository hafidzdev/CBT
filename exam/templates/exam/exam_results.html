<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Results - CBT System</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        green: {
                            50: '#f0fdf4',
                            100: '#dcfce7',
                            500: '#22c55e',
                            600: '#16a34a',
                            700: '#15803d',
                        },
                        red: {
                            50: '#fef2f2',
                            100: '#fee2e2',
                            500: '#ef4444',
                            600: '#dc2626',
                            700: '#b91c1c',
                        },
                        blue: {
                            50: '#eff6ff',
                            100: '#dbeafe',
                            500: '#3b82f6',
                            600: '#2563eb',
                            700: '#1d4ed8',
                        }
                    }
                }
            }
        }
    </script>
</head>
<body class="bg-gray-50">
    <!-- Navigation -->
    <nav class="bg-blue-600 text-white shadow-lg">
        <div class="container mx-auto px-4">
            <div class="flex justify-between items-center py-4">
                <div class="flex items-center space-x-3">
                    <i class="fas fa-chart-bar text-2xl"></i>
                    <h1 class="text-xl font-bold">Exam Results</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <a href="{% url 'student_dashboard' %}" class="bg-blue-500 hover:bg-blue-600 px-4 py-2 rounded-lg transition duration-200">
                        <i class="fas fa-arrow-left mr-2"></i>Back to Dashboard
                    </a>
                    <button onclick="window.print()" class="bg-green-500 hover:bg-green-600 px-4 py-2 rounded-lg transition duration-200">
                        <i class="fas fa-print mr-2"></i>Print Result
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container mx-auto px-4 py-8">
        <div class="max-w-6xl mx-auto">
            <!-- Result Summary -->
            <div class="bg-white rounded-2xl shadow-lg p-8 mb-8">
                <div class="text-center mb-8">
                    <h1 class="text-3xl font-bold text-gray-800 mb-2">{{ exam_session.exam.title }}</h1>
                    <p class="text-gray-600">{{ exam_session.exam.subject.name }}</p>
                </div>

                <!-- Score Card -->
                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white rounded-2xl p-6 text-center">
                        <div class="text-3xl font-bold mb-2">{{ exam_session.score|default:"0" }}/100</div>
                        <div class="text-blue-100">Final Score</div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-{{ exam_session.is_passed|yesno:'green,red' }}-500 to-{{ exam_session.is_passed|yesno:'green,red' }}-600 text-white rounded-2xl p-6 text-center">
                        <div class="text-3xl font-bold mb-2">
                            {% if exam_session.is_passed %}
                                <i class="fas fa-check-circle"></i>
                            {% else %}
                                <i class="fas fa-times-circle"></i>
                            {% endif %}
                        </div>
                        <div class="text-{{ exam_session.is_passed|yesno:'green,red' }}-100">
                            {{ exam_session.is_passed|yesno:"PASSED,FAILED" }}
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white rounded-2xl p-6 text-center">
                        <div class="text-3xl font-bold mb-2">{{ correct_answers }}/{{ total_questions }}</div>
                        <div class="text-purple-100">Correct Answers</div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white rounded-2xl p-6 text-center">
                        <div class="text-3xl font-bold mb-2">
                            {% if exam_session.time_spent %}
                                {{ exam_session.time_spent|divisibleby:60|yesno:"exam_session.time_spent|divide:60|floatformat:0,exam_session.time_spent" }}m
                            {% else %}
                                N/A
                            {% endif %}
                        </div>
                        <div class="text-orange-100">Time Spent</div>
                    </div>
                </div>

                <!-- Detailed Stats -->
                <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                    <div class="bg-gray-50 rounded-2xl p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Exam Information</h3>
                        <div class="space-y-3">
                            <div class="flex justify-between">
                                <span class="text-gray-600">Student:</span>
                                <span class="font-semibold">{{ exam_session.user.get_full_name|default:exam_session.user.username }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Started:</span>
                                <span class="font-semibold">{{ exam_session.start_time|date:"M d, Y H:i" }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Completed:</span>
                                <span class="font-semibold">{{ exam_session.end_time|date:"M d, Y H:i" }}</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Duration:</span>
                                <span class="font-semibold">{{ exam_session.exam.duration_minutes }} minutes</span>
                            </div>
                            <div class="flex justify-between">
                                <span class="text-gray-600">Passing Score:</span>
                                <span class="font-semibold">{{ exam_session.exam.passing_score }}%</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 rounded-2xl p-6">
                        <h3 class="text-lg font-semibold text-gray-800 mb-4">Performance Summary</h3>
                        <div class="space-y-4">
                            <!-- Progress Bar -->
                            <div>
                                <div class="flex justify-between mb-1">
                                    <span class="text-gray-600">Overall Performance</span>
                                    <span class="font-semibold">{{ exam_session.score|default:"0" }}%</span>
                                </div>
                                <div class="w-full bg-gray-200 rounded-full h-3">
                                    <div class="bg-{{ exam_session.is_passed|yesno:'green,red' }}-500 h-3 rounded-full" 
                                         style="width: {{ exam_session.score|default:'0' }}%"></div>
                                </div>
                            </div>
                            
                            <!-- Question Breakdown -->
                            <div class="grid grid-cols-3 gap-2 text-center">
                                <div class="bg-green-100 text-green-800 py-2 rounded-lg">
                                    <div class="font-bold">{{ correct_answers }}</div>
                                    <div class="text-sm">Correct</div>
                                </div>
                                <div class="bg-red-100 text-red-800 py-2 rounded-lg">
                                    <div class="font-bold">{{ wrong_answers }}</div>
                                    <div class="text-sm">Wrong</div>
                                </div>
                                <div class="bg-gray-100 text-gray-800 py-2 rounded-lg">
                                    <div class="font-bold">{{ skipped_questions }}</div>
                                    <div class="text-sm">Skipped</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Detailed Questions Review -->
            <!-- Di bagian Questions Review, ganti loop menjadi: -->
            <div class="space-y-4 max-h-96 overflow-y-auto">
                {% for user_answer in user_answers %}
                <div class="border border-gray-200 rounded-xl p-4 {% if user_answer.is_correct %}bg-green-50 border-green-200{% else %}bg-red-50 border-red-200{% endif %}">
                    <div class="flex items-start justify-between mb-3">
                        <span class="font-semibold text-gray-800">Question {{ forloop.counter }}</span>
                        <span class="{% if user_answer.is_correct %}text-green-600{% else %}text-red-600{% endif %} font-semibold text-sm">
                            {% if user_answer.is_correct %}
                            <i class="fas fa-check-circle mr-1"></i>Correct
                            {% else %}
                            <i class="fas fa-times-circle mr-1"></i>Incorrect
                            {% endif %}
                        </span>
                    </div>
                    <p class="text-gray-700 text-sm mb-2 line-clamp-2">{{ user_answer.question.text }}</p>
                    <div class="grid grid-cols-2 gap-2 text-xs">
                        <div>
                            <span class="text-gray-600">Your Answer:</span>
                            <p class="font-semibold {% if not user_answer.is_correct %}text-red-600{% endif %}">
                                {% with user_answer.selected_choices.first as selected_choice %}
                                {{ selected_choice.text|default:"No answer" }}
                                {% endwith %}
                            </p>
                        </div>
                        {% if not user_answer.is_correct %}
                        <div>
                            <span class="text-gray-600">Correct Answer:</span>
                            <p class="font-semibold text-green-600">
                                {% with user_answer.question.choices.filter.is_correct=True.first as correct_choice %}
                                {{ correct_choice.text|default:"N/A" }}
                                {% endwith %}
                            </p>
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endfor %}
            </div>
            <!-- Action Buttons -->
            <div class="flex justify-center space-x-4 mt-8">
                <a href="{% url 'student_dashboard' %}" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg transition duration-200 font-semibold">
                    <i class="fas fa-home mr-2"></i>Back to Dashboard
                </a>
                <button onclick="window.print()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg transition duration-200 font-semibold">
                    <i class="fas fa-print mr-2"></i>Print Result
                </button>
                {% if exam_session.exam.show_result_immediately %}
                <a href="{% url 'start_exam' exam_session.exam.id %}" class="bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg transition duration-200 font-semibold">
                    <i class="fas fa-redo mr-2"></i>Retake Exam
                </a>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Print Styles -->
    <style>
        @media print {
            nav, button, a {
                display: none !important;
            }
            body {
                background: white !important;
            }
            .bg-gray-50 {
                background: white !important;
            }
            .shadow-lg {
                box-shadow: none !important;
            }
            .border {
                border-color: #e5e7eb !important;
            }
        }
    </style>

    <script>
        // Add animation to score cards
        document.addEventListener('DOMContentLoaded', function() {
            const scoreCards = document.querySelectorAll('.bg-gradient-to-r');
            scoreCards.forEach((card, index) => {
                card.style.opacity = '0';
                card.style.transform = 'translateY(20px)';
                setTimeout(() => {
                    card.style.transition = 'all 0.5s ease';
                    card.style.opacity = '1';
                    card.style.transform = 'translateY(0)';
                }, index * 200);
            });
        });
    </script>
</body>
</html>